<div class="modal-overlay" (click)="closeModal()">
  <div class="modal-content" (click)="stopPropagation($event)">
    <div class="modal-header">
      <h2>Buscar Disponibilidad</h2>
      <p class="room-name">{{ roomName }}</p>
      <button class="close-btn" (click)="closeModal()">‚úï</button>
    </div>

    <div class="modal-body">
      <div class="date-selector">
        <div class="form-group">
          <label for="checkInModal">Fecha de Entrada</label>
          <input 
            type="date" 
            id="checkInModal" 
            name="checkIn"
            [(ngModel)]="checkIn"
            [min]="minDate"
            (change)="onCheckInChange()"
            required>
        </div>

        <div class="form-group">
          <label for="checkOutModal">Fecha de Salida</label>
          <input 
            type="date" 
            id="checkOutModal" 
            name="checkOut"
            [(ngModel)]="checkOut"
            [min]="checkIn"
            required>
        </div>
      </div>

      <div class="error-message" *ngIf="errorMessage">
        ‚ö†Ô∏è {{ errorMessage }}
      </div>

      <div class="result-container" *ngIf="result && !isLoading && !showClientForm">
        <div class="success-message" *ngIf="result.isAvailable">
          <div class="icon">‚úÖ</div>
          <h3>¬°Habitaci√≥n Disponible!</h3>
          <p>La habitaci√≥n est√° disponible para las fechas seleccionadas.</p>
          <div class="room-details">
            <p><strong>Habitaci√≥n:</strong> {{ result.name }}</p>
            <p *ngIf="result.description"><strong>Descripci√≥n:</strong> {{ result.description }}</p>
            <p><strong>Precio:</strong> ${{ result.price | number:'1.0-0' }} /noche</p>
            <p><strong>Capacidad:</strong> {{ result.capacity }} persona(s)</p>
            <div *ngIf="result.amenities && result.amenities.length > 0" class="amenities-list">
              <strong>Amenidades:</strong>
              <ul>
                <li *ngFor="let amenity of result.amenities">{{ amenity.name }}</li>
              </ul>
            </div>
          </div>
          <button class="book-btn" (click)="showBookingForm()">Reservar Ahora</button>
        </div>

        <div class="alternative-message" *ngIf="!result.isAvailable">
          <div class="icon">‚ÑπÔ∏è</div>
          <h3>Habitaci√≥n No Disponible</h3>
          <p>La habitaci√≥n solicitada no est√° disponible, pero tenemos una alternativa del mismo tipo:</p>
          <div class="room-details">
            <p><strong>Habitaci√≥n:</strong> {{ result.name }}</p>
            <p *ngIf="result.description"><strong>Descripci√≥n:</strong> {{ result.description }}</p>
            <p><strong>Precio:</strong> ${{ result.price | number:'1.0-0' }} /noche</p>
            <p><strong>Capacidad:</strong> {{ result.capacity }} persona(s)</p>
            <div *ngIf="result.amenities && result.amenities.length > 0" class="amenities-list">
              <strong>Amenidades:</strong>
              <ul>
                <li *ngFor="let amenity of result.amenities">{{ amenity.name }}</li>
              </ul>
            </div>
          </div>
          <button class="book-btn" (click)="showBookingForm()">Reservar Alternativa</button>
        </div>
      </div>

      <!-- Formulario de cliente -->
      <div class="client-form-container" *ngIf="showClientForm">
        <h3>Datos del Cliente</h3>
        <p class="form-subtitle">Complete sus datos para continuar con la reserva</p>
        
        <form class="client-form">
          <div class="form-row">
            <div class="form-group">
              <label for="clientName">Nombre *</label>
              <input 
                type="text" 
                id="clientName" 
                name="name"
                [(ngModel)]="client.name"
                placeholder="Ingrese su nombre"
                required>
            </div>

            <div class="form-group">
              <label for="clientLastName">Apellido *</label>
              <input 
                type="text" 
                id="clientLastName" 
                name="lastName"
                [(ngModel)]="client.lastName"
                placeholder="Ingrese su apellido"
                required>
            </div>
          </div>

          <div class="form-group">
            <label for="clientEmail">Email *</label>
            <input 
              type="email" 
              id="clientEmail" 
              name="email"
              [(ngModel)]="client.email"
              placeholder="ejemplo@correo.com"
              required>
          </div>

          <div class="form-group">
            <label for="clientPhone">Tel√©fono *</label>
            <input 
              type="tel" 
              id="clientPhone" 
              name="phoneNumber"
              [(ngModel)]="client.phoneNumber"
              placeholder="3001234567"
              required>
          </div>

          <div class="form-actions">
            <button type="button" class="cancel-btn" (click)="cancelClientForm()" [disabled]="isCreatingClient || isCreatingBooking">
              Volver
            </button>
            <button 
              type="button" 
              class="submit-btn primary-action" 
              (click)="createClientAndCompleteBooking()" 
              [disabled]="isCreatingClient || isCreatingBooking">
              <span *ngIf="!isCreatingClient && !isCreatingBooking">‚úì Finalizar Reserva</span>
              <span *ngIf="isCreatingClient">Guardando datos...</span>
              <span *ngIf="isCreatingBooking">Finalizando reserva...</span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <div class="modal-footer" *ngIf="!showClientForm">
      <button class="cancel-btn" (click)="closeModal()" [disabled]="isLoading">
        Cancelar
      </button>
      <button class="search-btn" (click)="searchAvailability()" [disabled]="isLoading">
        <span *ngIf="!isLoading">üîç Buscar</span>
        <span *ngIf="isLoading">Buscando...</span>
      </button>
    </div>
  </div>
</div>
